<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>Kettlebell Timer</title>
	<style>
		p {
			font-size: 70px;
		}
	</style>
</head>

<body>
	<center>
		<h1 style="font-family: Segoe, Segoe UI, DejaVu Sans, Trebuchet MS, Verdana,' sans-serif'">Kettlebell Timer</h1>
		<p style="font-size: 16px">If number of sets left blank, defaults to 1 set</p>
		<form>
			Number of sets: <input type="number" id="goalSets"><br> Reps per set: <input type="number" id="goalReps"><br> Time per set in minutes: <input type="number" id="goalTime"><br>
		</form>
		<br>
		<button onclick="startBeeps()">Start</button>
		<button onclick="resetBeeps()">Stop</button>
		<p id="repCount" style="margin-top: 20px">Rep Count: 0</p>
		<p id="timeLabel" style="font-size: 90px; margin-top: -50px">0:00</p>
		<p id="setLabel" style="margin-top: -70px">Sets Left: 0</p>
	</center>

	<script>
		var audio = new Audio('beep.wav');
		var count = 1;
		var stop = 0;
		var setsLeft;
		var countdownTime = (document.getElementById("goalTime").value) - 1;
		var reps;
		var repCounter, secondCounter, secondCountdown, minuteCountdown;
		var minutesLeft, secondsLeft;

		function startBeeps() {
			if (document.getElementById("goalReps").value == "" || document.getElementById("goalReps").value == " ") {
				document.getElementById("repCount").innerHTML = "Please set a goal RPM";
			} else {
				document.getElementById("repCount").innerHTML = "Rep Count: 0";
				var time = (60 / (parseFloat(parseFloat(document.getElementById("goalReps").value) / document.getElementById("goalTime").value))) * 1000;

				if (document.getElementById("goalSets").value == "") {
					setsLeft = 0;
				} else {
					setsLeft = document.getElementById("goalSets").value - 1;
					document.getElementById("setLabel").innerHTML = "Sets Left: " + (setsLeft);
				}
				countdownTime = (60 * (parseFloat(document.getElementById("goalTime").value))) - 1;
				minutesLeft = Math.floor(countdownTime / 60);
				secondsLeft = countdownTime - (minutesLeft * 60);
				startCount();

				function startCount() {

					document.getElementById("timeLabel").innerHTML = "0:00";
					minutesLeft = Math.floor(countdownTime / 60);
					secondsLeft = countdownTime - (minutesLeft * 60);

					document.getElementById("timeLabel").innerHTML = "0:00";

					secondCountdown = setInterval(function() {

						if (secondsLeft == 0 && minutesLeft == 0) {
							if (setsLeft == 0) {
								audio.play();
								document.getElementById("repCount").innerHTML = "Rep Count: " + count++;
								stopBeeps();
							} else {
								setsLeft--;
								document.getElementById("setLabel").innerHTML = "Sets Left: " + (setsLeft);
								audio.play();
								document.getElementById("repCount").innerHTML = "Rep Count: " + count;
								clearInterval(repCounter);
								clearInterval(secondCountdown);
								countdownTime = (60 * (parseFloat(document.getElementById("goalTime").value)))
								count++;
								startCount();
							}
						}
						if (secondsLeft == -1) {
							minutesLeft = minutesLeft - 1;
							secondsLeft = 60;
						}
						if (secondsLeft == 60) {
							secondsLeft = 59;
							document.getElementById("timeLabel").innerHTML = minutesLeft + ":0" + secondsLeft;
						}
						if (secondsLeft < 10) {
							document.getElementById("timeLabel").innerHTML = minutesLeft + ":0" + secondsLeft--;
						} else {
							document.getElementById("timeLabel").innerHTML = minutesLeft + ":" + secondsLeft--;
						}
					}, 1000);

					repCounter = setInterval(function() {
						audio.play();
						document.getElementById("repCount").innerHTML = "Rep Count: " + count++;
					}, time);
				}
			}
		}

		function stopBeeps() {
			count = 1;
			countdownTime = document.getElementById("goalTime").value - 1;
			clearInterval(repCounter);
			clearInterval(secondCountdown);
		}

		function resetBeeps() {
			count = 1;
			countdownTime = document.getElementById("goalTime").value - 1;
			document.getElementById("repCount").innerHTML = "Rep Count: 0";
			document.getElementById("timeLabel").innerHTML = "0:00";
			clearInterval(repCounter);
			clearInterval(secondCountdown);
		}
	</script>
</body>

</html>
